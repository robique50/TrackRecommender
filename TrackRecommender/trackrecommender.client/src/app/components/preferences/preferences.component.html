<app-main-navbar></app-main-navbar>

<div class="preferences-container">
  <div class="preferences-content-wrapper">
    <div class="preferences-header">
      <h1>Trail Preferences</h1>
      <p>Customize your trail recommendations</p>
    </div>

    <div class="loading-state" *ngIf="isLoading">
      <div class="loading-spinner"></div>
      <p>Loading preferences...</p>
    </div>

    <div class="error-state" *ngIf="error">
      <p class="error-message">{{ error }}</p>
    </div>

    <form
      *ngIf="!isLoading && preferencesForm"
      [formGroup]="preferencesForm"
      (ngSubmit)="onSubmit()"
      class="preferences-form"
    >
      <div class="form-section">
        <h3>Preferred Trail Types</h3>
        <div class="checkbox-group">
          <label *ngFor="let type of options.trailTypes" class="checkbox-label">
            <input
              type="checkbox"
              [value]="type"
              (change)="onTrailTypeChange($event, type)"
            />
            <span>{{ type }}</span>
          </label>
        </div>
      </div>

      <div class="form-section">
        <h3>Preferred Difficulty</h3>
        <div class="radio-group">
          <label
            *ngFor="let difficulty of options.difficulties"
            class="radio-label"
          >
            <input
              type="radio"
              formControlName="preferredDifficulty"
              [value]="difficulty"
            />
            <span
              class="difficulty-indicator"
              [style.background-color]="getDifficultyColor(difficulty)"
            ></span>
            <span>{{ difficulty }}</span>
          </label>
        </div>
      </div>

      <div class="form-section">
        <h3>Trail Categories</h3>
        <div class="checkbox-group">
          <label
            *ngFor="let category of options.categories"
            class="checkbox-label"
          >
            <input
              type="checkbox"
              [value]="category"
              (change)="onCategoryChange($event, category)"
            />
            <span>{{ category }}</span>
          </label>
        </div>
      </div>

      <div class="form-section">
        <h3>Maximum Distance (km)</h3>
        <div class="slider-container">
          <input
            type="range"
            formControlName="maxDistance"
            [min]="options.minDistance"
            [max]="options.maxDistance"
            step="0.5"
            class="distance-slider"
          />
          <div class="slider-value">
            {{ preferencesForm.get("maxDistance")?.value }} km
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Maximum Duration (hours)</h3>
        <div class="slider-container">
          <input
            type="range"
            formControlName="maxDuration"
            [min]="options.minDuration"
            [max]="options.maxDuration"
            step="0.5"
            class="duration-slider"
          />
          <div class="slider-value">
            {{ formatDuration(preferencesForm.get("maxDuration")?.value) }}
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Preferred Regions</h3>
        <div class="regions-grid">
          <div
            *ngFor="let region of options.regions"
            class="region-card"
            [class.selected]="isRegionSelected(region.name)"
            (click)="toggleRegion(region.name)"
          >
            <div class="region-name">{{ region.name }}</div>
            <div class="region-trails">{{ region.trailCount }} trails</div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Trail Features & Tags</h3>
        <div class="tags-container">
          <div *ngFor="let tag of groupedTags" class="tag-group">
            <h4>{{ tag.category }}</h4>
            <div class="tag-chips">
              <div
                *ngFor="let tagValue of tag.tags"
                class="tag-chip"
                [class.selected]="isTagSelected(tagValue)"
                (click)="toggleTag(tagValue)"
              >
                {{ formatTag(tagValue) }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Minimum Trail Rating</h3>
        <div class="rating-selector">
          <div class="star-rating">
            <button
              type="button"
              *ngFor="let star of [1, 2, 3, 4, 5]"
              class="star-button"
              [class.active]="
                (preferencesForm.get('minimumRating')?.value || 0) >= star
              "
              (click)="setMinimumRating(star)"
            >
              â˜…
            </button>
          </div>
          <span class="rating-text">
            {{ preferencesForm.get("minimumRating")?.value || 0 }} stars minimum
          </span>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="resetForm()">
          Reset to Defaults
        </button>
        <button type="submit" class="btn-primary" [disabled]="isSaving">
          <span *ngIf="!isSaving">Save Preferences</span>
          <span *ngIf="isSaving" class="loading-spinner"></span>
        </button>
      </div>

      <div class="success-message" *ngIf="successMessage">
        {{ successMessage }}
      </div>
    </form>
  </div>
</div>
